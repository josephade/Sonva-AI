<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AI Dental Receptionist — Demo Dashboard</title>
  <style>
    body { font-family: system-ui, sans-serif; margin: 24px; }
    h1 { margin-top: 0; }
    .row { display: flex; gap: 16px; align-items: center; }
    .tag { background: #eee; padding: 4px 8px; border-radius: 999px; font-size: 12px; }
    .card { border: 1px solid #ddd; border-radius: 12px; padding: 16px; margin-bottom: 16px; }
    .turn { margin: 8px 0; }
    .who { font-weight: 600; }
    .small { color: #666; font-size: 12px; }
    .pill { display:inline-block; border:1px solid #ddd; border-radius:999px; padding:4px 10px; margin-right:8px; font-size:12px; }
    .grid { display: grid; grid-template-columns: 1.2fr 2fr; gap: 24px; }
    .muted { color: #666; }
    code { background: #f6f8fa; padding: 2px 6px; border-radius: 6px; }
    .footer { margin-top: 32px; color:#888; font-size: 12px; }
  </style>
</head>
<body>
  <h1>AI Dental Receptionist — Demo Dashboard</h1>
  <div class="row">
    <div class="tag" id="status">Connecting…</div>
    <div class="small">Refreshes every 2s</div>
  </div>

  <div class="grid">
    <div>
      <h2>Recent Calls</h2>
      <div id="calls"></div>
    </div>
    <div>
      <h2>Current Clinic Profile</h2>
      <div class="card">
        <div><span class="pill">Name</span> <strong id="clinic_name"></strong></div>
        <div><span class="pill">Phone</span> <span id="clinic_phone"></span></div>
        <div><span class="pill">Address</span> <span id="clinic_address"></span></div>
        <div><span class="pill">Hours</span> <span id="clinic_hours"></span></div>
        <div><span class="pill">Insurance</span> <span id="clinic_insurance"></span></div>
      </div>
      <h3>How to wire Twilio</h3>
      <div class="card">
        Point your Number’s <strong>Voice webhook</strong> to:
        <div><code id="webhook_url">/voice/incoming</code></div>
        <div class="small muted">Example during local dev (ngrok): <code>https://YOUR-NGROK-ID.ngrok.io/voice/incoming</code></div>
      </div>
    </div>
  </div>

  <div class="footer">Made for quick demos — turn-based voice. For streaming audio, upgrade to Twilio Media Streams later.</div>

  <script>
    async function refresh() {
      try {
        const r = await fetch('/api/state');
        const data = await r.json();
        document.getElementById('status').innerText = 'Live';
        document.getElementById('clinic_name').innerText = data.clinic.name;
        document.getElementById('clinic_phone').innerText = data.clinic.phone;
        document.getElementById('clinic_address').innerText = data.clinic.address;
        document.getElementById('clinic_hours').innerText = data.clinic.hours;
        document.getElementById('clinic_insurance').innerText = data.clinic.insurance;

        const callsDiv = document.getElementById('calls');
        callsDiv.innerHTML = '';
        data.calls.slice(0, 8).forEach(call => {
          const el = document.createElement('div');
          el.className = 'card';
          el.innerHTML = `
            <div class="row">
              <div><strong>${call.from || 'Unknown Caller'}</strong></div>
              <div class="small">${new Date(call.started_at).toLocaleString()}</div>
              <div class="tag">${call.status}</div>
            </div>
            <div class="small muted">Turns: ${call.turns.length}</div>
            ${call.turns.map(t => `
              <div class="turn">
                <div class="who">${t.speaker === 'human' ? 'Caller' : 'AI'}</div>
                <div>${t.text}</div>
                ${t.intent ? `<div class="small muted">Intent: ${t.intent}</div>` : ''}
                ${t.audio_url ? `<audio controls src="${t.audio_url}"></audio>` : ''}
              </div>
            `).join('')}
          `;
          callsDiv.appendChild(el);
        });
      } catch (e) {
        document.getElementById('status').innerText = 'Offline';
      }
    }
    refresh();
    setInterval(refresh, 2000);
  </script>
</body>
</html>
